<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Goblin Store</title>
    <link rel="icon" type="image/ico" href="../styles/pics/tiny.png" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <link href="../styles/main.css" rel="stylesheet" />
    <!-- Load jQuery from a cdn (cloudflare) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
  </head>

  <body>
    <!-- Header -->
    <div id="header"></div>

    <div class="container pt-3 pb-5">
      <h1 class="mb-4">Checkout</h1>
      <h2 class="mb-4">Order details</h2>
      <div class="orderBody">
        <!-- Section for the order details to be loaded from the shopping cart -->
        <p>Order body</p>
        <div class="orderDetails">
          <p>Order details</p>
        </div>
        <div class="checkoutTotal">
          <p>Checkout total</p>
        </div>
      </div>
    </div>

    <div class="container pt-3 pb-5">
      <h2>Contact details</h2>
      <div class="row g-3 needs-validation" novalidate>
        <div class="col-md-6">
            <label for="inputFirstName" class="col-form-label">First name</label>
            <input type="text" id="inputFirstName" class="form-control" aria-labelledby="firstNamelHelpInline" placeholder="Alan" required>
            <div class="invalid-feedback">
              Please enter your first name.
            </div>
        </div>
        <div class="col-md-4">
          <label for="inputLastName" class="col-form-label">Last name</label>
          <input type="text" id="inputLastName" class="form-control" aria-labelledby="lastNameHelpInline" placeholder="Henry" required>
          <div class="invalid-feedback">
            Please enter your last name.
          </div>
        </div>
        <div class="col-md-4">
            <label for="inputEmail" class="col-form-label">Email address</label>
            <input type="email" id="inputEmail" class="form-control" aria-labelledby="emailHelpInline" placeholder="name@example.com" pattern="\b[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}\b" required>
            <div class="invalid-feedback">
              Please enter your email address.
            </div>
        </div>
        <div class="col-md-4">
          <label for="phoneNumber" class="col-form-label">Phone Number</label>
          <input type="tel" id="phoneNumber" class="form-control" aria-labelledby="phoneHumberInline" placeholder="00000000000" pattern="^(?:(?:\(?(?:0(?:0|11)\)?[\s-]?\(?|\+)44\)?[\s-]?(?:\(?0\)?[\s-]?)?)|(?:\(?0))(?:(?:\d{5}\)?[\s-]?\d{4,5})|(?:\d{4}\)?[\s-]?(?:\d{5}|\d{3}[\s-]?\d{3}))|(?:\d{3}\)?[\s-]?\d{3}[\s-]?\d{3,4})|(?:\d{2}\)?[\s-]?\d{4}[\s-]?\d{4}))(?:[\s-]?(?:x|ext\.?|\#)\d{3,4})?$" required>
          <div class="invalid-feedback">
            Please enter a your phone number.
          </div>
        </div>
        <div class="col-md-4">
          <label for="inputAddress" class="col-form-label">Address</label>
          <input type="text" id="inputAddress" class="form-control" aria-labelledby="addressHelpInline" placeholder="1 Buckingham Palace, London, SW1A 1AA" required>
          <div class="invalid-feedback">
            Please enter your address.
          </div>
        </div>
        <div class="col-md-4">
          <label for="inputCardNumber" class="col-form-label">Credit Card Number</label>
          <input type="text" id="inputCardNumber" class="form-control" aria-labelledby="cardNumberHelpInline" placeholder="12345678912345678" pattern="\d{16}" required>
          <div class="invalid-feedback">
            Please enter your credit card number.
          </div>
        </div>
        <div class="col-md-4">
          <label for="inputCardExpiryDate" class="col-form-label">Credit Card Expiry Date</label>
          <input type="text" id="inputCardExpiryDate" class="form-control" aria-labelledby="cardExpiryDateHelpInline" placeholder="12/25" pattern="\d{2}/\d{2}" required>
          <div class="invalid-feedback">
            Please enter your credit card expiry date (mm/yy).
          </div>
        </div>
        <div class="col-md-4">
          <label for="inputCardCode" class="col-form-label">Credit Card 3-digit Code</label>
          <input type="text" id="inputCardCode" class="form-control" aria-labelledby="cardCodeHelpInline" placeholder="123" pattern="\d{3}" required>
          <div class="invalid-feedback">
            Please enter your credit card security code.
          </div>
        </div>
      </div>
    </div>
      
    <!-- Shopping Cart Button -->
    <div id="shoppingCart"></div>

    <!-- Footer -->
    <div id="footer"></div>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"
    ></script>

    <!-- Shopping Cart JS business logic -->
    <script src="../../resources/scripts/checkout.js"></script>

    <script>
      // on document ready
      $(document).ready(() => {
        // Load the header.html into the header div, once it's loaded execute callback to add class to headerHome div
        $("#header").load("./template/header.html", () => {
          $("#headerCheckout")
            .removeClass()
            .addClass("nav-link active text-black fw-bold");
        });

        // Load the footer.html into the footer div, once it's loaded execute callback to add class to footerHome div
        $("#footer").load("./template/footer.html", () => {
          $("#footerCheckout")
            .removeClass()
            .addClass("nav-link active text-black fw-bold");
        });

        // Load shoppingCart.html
        $("#shoppingCart").load("./shoppingCart.html");

        // Set product variable
        let product = [];

        if (localStorage.getItem("items")) {
          products = JSON.parse(localStorage.getItem("items"));
          let orderBody = $(".orderBody");

          // render products name, price, and quantity
          function updateBody(product) {
            orderBody.empty(); // empty the initial contents of order body div before adding new items
            products.map((product) => {
              orderBody.append(
                `<div class="orderDetails" id="${product.name}">
                  <div class="mb-4" id="productInfo">
                    <img class="image" src="${product.image}" alt="" width="100" height="100">
                    <div class="row">
                      <div class="name col-sm-3"><strong>${product.name}</strong></div>
                      <div class="price col-sm-5">$${product.price}/item</div>
                      <div class="quantity col-sm-2">x ${product.quantity}</div>
                      <div class="itemSubTotal col-sm-2">$${product.price * product.quantity}</div>
                    </div>
                  </div>
                </div>`
              );
            });
          };

          // Run function
          updateBody(product);

          // Set checkoutTotal variable
          var checkoutTotal = 0;

          // Update total cost
          function updateCartTotal(product) {

            let checkoutArray = [];

            products.map((product) => {
              checkoutArray.push(product.quantity * product.price);
            });
            
            // Sum array
            checkoutTotal = checkoutArray.reduce((a, b) => a + b, 0);
          };

          // Run function
          updateCartTotal(product);

          // Append total cost div to bottom of checkout page
          orderBody.append(
            `<div class="checkoutTotal mt-4">
              <div class="row">
                <div class="col-sm-10 text-end"><strong>Total cost:</strong></div>
                <div class="checkoutTotalText col-sm-2"><strong>$${checkoutTotal}</strong></div>
            </div>`
          );
        };
      });

    </script>
  </body>
</html>
